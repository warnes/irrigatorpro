{% extends "base.html" %}

{% block scripts %}
  <script type="text/javascript">
    $(function() {
      $('#formset tbody tr').formset({
        addText: '<i class="iTooltip add-icon fa fa-plus-square" help="Add Row"> Add Row</i>',
        deleteText: '<i class="iTooltip delete-icon fa fa-minus-square" help="Delete Row"></i>' //'Delete Row',
      });

    <!--  !! DOESNT WORK ON IE 11.0.4 !! -->
    <!--   /** -->
    <!--    Sort users by selected status, value (descending), and text. -->
    <!--    **/ -->

    <!--   options = $('select#id_users option'); -->

    <!--   arr = options.map(function(_, o) { -->
    <!--             return { -->
    <!--                 t: o.text, -->
    <!--                 v: parseInt(o.value), -->
    <!--                 s: o.selected -->
    <!--             }; -->
    <!--         }).get(); -->

    <!--   arr.sort(function(o1, o2) { -->
    <!--       /* Selected - Selected First */ -->
    <!--       if( o1.s < o2.s ) return +1; -->
    <!--       if( o1.s > o1.s ) return -1; -->

    <!--       /* Value - descending */ -->
    <!--       if( parseInt(o1.v) < parseInt(o2.v) ) return +1; -->
    <!--       if( parseInt(o1.v) > parseInt(o2.v) ) return -1; -->

    <!--       /* Text - Increasing */ -->
    <!--       if( o1.v < o2.v ) return -1; -->
    <!--       if( o1.v > o2.v ) return +1; -->
	
    <!--       return 0; -->
    <!--   }); -->
    <!--   options.each(function(i, o) { -->
    <!--       o.value = arr[i].v; -->
    <!--       o.text = arr[i].t; -->
    <!--       o.selected = arr[i].s; -->
    <!--   }); -->
    <!--   $('select#id_users').scrollTop(0,0); -->
    <!-- }) -->
  </script>
{% endblock %}


{% block content %}

  <h1>
    <i class="fa fa-pencil-square-o fa-fw"></i>
    Summary report
  </h1>

  <h2>
    <em>{{crop_season}}</em>
  </h2>

    
    {% if object_list %}

  <table class="formset summary-report" id="summary-report" >
    <thead>
      <tr class = "header1">
	<th rowspan=2>Field</th>
	<th rowspan=2>Growth Stage</th>
	<th colspan=4>Water</th>
	<th colspan=2>Last Entry</th>
	<th rowspan=2>Status</th>
	<th rowspan=2>Water Register</th>
      </tr>
      <tr class="header2">
	<th>DWU</th>
	<th>AWC</th>
	<th>Rain</th>
	<th>Irrigation</th>
	<th>Type</th>
	<th>Date</th>
      </tr>
    </thead>
    <tbody>
      {% for object in object_list %}
      <tr>
	<td>{{ object.field}} </td>
	<td>{{ object.growth_stage }}</td>
	<td>{{ object.dwu }}</td>
	<td>{{ object.awc }}</td>
	<td>{{ object.cumulative_rain }}</td>
	<td>{{ object.cumulative_irrigation_vol }}</td>
	<td>{{ object.last_data_entry_type }}</td>
	<td>{{ object.time_last_data_entry }}</td>


	<!-- Copy code from water_register for the status. -->
	<td>
		{% if object.water_registry_object.irrigate_flag %}
		  <div class="alert-inline alert-danger">
		    <b>Irrigate Today</b>
		    {% if object.water_registry_object.average_water_content <= 0.0 %}
		      AWC
		    {% endif %}
		    {% if object.water_registry_object.max_temp_2in < object.water_registry_object.max_observed_temp_2in %}
		      Temp
		    {% endif %}
		  </div>
		{% elif object.water_registry_object.check_sensors_flag %}
		  <div class="alert-inline alert-warning">
		    Irrigate 1-5 Days
		  </div>
		{% endif %}
		{% if object.water_registry_object.dry_down_flag %}
		  <div class="alert-inline alert-info">
		    Dry-Down
		  </div>
		{% endif %}
	</td>

	<td><a href = 'http://{{ object.water_registry_url }}'> link </a></td>
      </tr>

      {% endfor %}
  
    </tbody>
  </table>

    {% else %}
      <b> Nothing to display yet. </b>
    {% endif %}

{% endblock %}
