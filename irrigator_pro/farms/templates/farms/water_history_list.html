{% extends "base.html" %}


{% block scripts %}
<script type="text/javascript">
    $(function() {
        /* Enable add row / delete row */
        $('#formset tbody tr').formset({
            addText: '<i class="iTooltip add-icon fa fa-plus-square" help="Add Row"> Add Row</i>',
            deleteText: '<i class="iTooltip delete-icon fa fa-minus-square" help="Delete Row"></i>',
            added: function(row) {
                                   $("input[id$=date]").prop("class","").datepicker();
                                   $("input[type$=number]").prop("value","0.0");
                                 },
        })

        /* Restrict dates to range specified by crop season */
        $('input[id$=date]').datepicker( 
            "option", "minDate", '{{ season.season_start_date|date:"Y-m-d" }}'
        ).datepicker(
            "option", "maxDate", '{{ season.season_end_date|date:"Y-m-d" }}' 
        );

    })
</script>
{% endblock %}


{% block content %}

  <h1>
    <i class="fa fa-cloud fa-fw"></i>
    Rainfall and Irrigation
  </h1>

  <h2>Season: <em>{{season}}</em>
    {% if field %}
      - Field: <em>{{ field }}</em>
    {% endif %}
  </h2>

  <form id="formset" action="{{ request.path }}" method="post">{% csrf_token %}


    {% if formset.total_error_count %}
      {% for dict in formset.errors %}
        {% for error in dict.values %}
  	  <div class="alert alert-danger">
  	    {{ error }}
  	  </div>
        {% endfor %}
      {% endfor %}
    {% endif %}


    <table class="formset" >

      <thead>
	<tr>
	  <th>Date</th>
	  <th>Fields</th>
	  <th>Rain</th>
	  <th>Irrigation</th>
	  <th>Comment</th>
	  <th>Delete</th>
	</tr>
      </thead>


      <tbody>
	{% for field in formset %}
	  <tr>
	    {% for input in field %}
	      {% if not input.is_hidden %}
		<td>
		  {% if input.errors %}
		    <div class="inline-alert alert-danger">
		      {{ input.errors }}
	            </div>
		  {% endif %}
		  {{ input }}
		</td>
	      {% else %}
		{{ input }}
	      {% endif %}
	    {% endfor %}
	  </tr>
	{% endfor %}
	</table>


    <div class="submit-bar">
      <button value="Submit" type="submit" class="btn btn-success">
	<i class="fa fa-floppy-o"></i> Save Changes
      </button>


      {% if object.pk %}
	<a class="btn btn-warning" href="{% url 'farm_list' %}{{ object.pk }}">
	  <i class="fa fa-undo fa-fw"></i> Cancel Changes
	</a>
      {% else %}
	<a class="btn btn-warning" href="{% url 'farm_list' %}">
	  <i class="fa fa-undo fa-fw"></i> Cancel Changes
	</a>
      {% endif %}

      {% if object.pk %}
	<a class="btn btn-danger" href="{% url 'farm_list' %}delete/{{ object.pk }}">
	  <i class="fa fa-times fa-fw"></i> Delete
	</a>
      {% endif %}

    </div>


    {{ formset.management_form }}


  </form>

{% endblock %}
