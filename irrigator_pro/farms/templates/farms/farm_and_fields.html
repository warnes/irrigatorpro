{% extends "base.html" %}


{% block scripts %}
  <script type="text/javascript">
    $(function() {
      $('#formset tbody tr').formset({
        addText: '<i class="iTooltip add-icon fa fa-plus-square" help="Add Row"> Add Row</i>',
        deleteText: '<i class="iTooltip delete-icon fa fa-minus-square" help="Delete Row"></i>' //'Delete Row',
      });

    <!--  !! DOESNT WORK ON IE 11.0.4 !! -->
    <!--   /** -->
    <!--    Sort users by selected status, value (descending), and text. -->
    <!--    **/ -->

    <!--   options = $('select#id_users option'); -->

    <!--   arr = options.map(function(_, o) { -->
    <!--             return { -->
    <!--                 t: o.text, -->
    <!--                 v: parseInt(o.value), -->
    <!--                 s: o.selected -->
    <!--             }; -->
    <!--         }).get(); -->

    <!--   arr.sort(function(o1, o2) { -->
    <!--       /* Selected - Selected First */ -->
    <!--       if( o1.s < o2.s ) return +1; -->
    <!--       if( o1.s > o1.s ) return -1; -->

    <!--       /* Value - descending */ -->
    <!--       if( parseInt(o1.v) < parseInt(o2.v) ) return +1; -->
    <!--       if( parseInt(o1.v) > parseInt(o2.v) ) return -1; -->

    <!--       /* Text - Increasing */ -->
    <!--       if( o1.v < o2.v ) return -1; -->
    <!--       if( o1.v > o2.v ) return +1; -->
	
    <!--       return 0; -->
    <!--   }); -->
    <!--   options.each(function(i, o) { -->
    <!--       o.value = arr[i].v; -->
    <!--       o.text = arr[i].t; -->
    <!--       o.selected = arr[i].s; -->
    <!--   }); -->
    <!--   $('select#id_users').scrollTop(0,0); -->
    <!-- }) -->
  </script>
{% endblock %}


{% block content %}

  <h1>Farm
    -
    <em>{{form.name.value}}</em>
  </h1>

  <form action="{{ request.path }}" method="post">{% csrf_token %}

    {% if form.non_field_errors %}
      <div class="alert alert-danger">
	{{ form.non_field_errors }}
      </div>
    {% endif %}

    <table class="default-form">
      <tbody>
	{% for input in form %}
	  <tr>
	    <td>{{ input.label_tag }}</td> 
	    <td>{{ input }}</td>
	    <td>
	      {% if input.errors %}
		<div class="inline-alert alert-danger">
		  {{ input.errors }}
	        </div>
	      {% else %}
		{% if input.field.required %}(Required){% endif %}
	      {% endif %}	
	    </td>
	  </tr>
	{% endfor %}
      </tbody>
    </table>

    <h2>Fields</h2>


    {% if field_form.non_form_errors %}
      {% for dict in formset.non_form_errors %}
        {% for key,value in dict.items %}
  	  <div class="alert alert-danger">
  	    {{ value }}
  	  </div>
        {% endfor %}
      {% endfor %}
    {% endif %}

    
    <table id="formset" class="formset default-form">
      <thead>
	<tr>
	  {% for label in field_form_headers %}
	    <th>{{ label }}</th> 
	  {% endfor %}
	</tr>
      </thead>

      <tbody>
	{% for field in field_form %}
	  <tr>
	    {% for input in field %}
	      <td>
		{% if input.errors %}
		  <div class="inline-alert alert-danger">
		    {{ input.errors }}
	          </div>
		{% endif %}
		{{ input }}
	      </td>
	    {% endfor %}
	  </tr>
	{% endfor %}
      </tbody>
    </table>

    <div class="submit-bar">

      <button value="Submit" type="submit" class="btn btn-success">
	<i class="fa fa-floppy-o"></i> Save Changes
      </button>

      {% if object.pk %}
	<a class="btn btn-warning" href="{% url 'farm_list' %}{{ object.pk }}">
	  <i class="fa fa-undo fa-fw"></i> Cancel Changes
	</a>
      {% else %}
	<a class="btn btn-warning" href="{% url 'farm_list' %}">
	  <i class="fa fa-undo fa-fw"></i> Cancel Changes
	</a>
      {% endif %}

      {% if object.pk %}
	<a class="btn btn-danger" href="{% url 'farm_list' %}delete/{{ object.pk }}">
	  <i class="fa fa-times fa-fw"></i> Delete
	</a>
      {% endif %}

    </div>


    {{ field_form.management_form }}

  </form>

  
{% endblock %}
